# 开发日志 - 2026年第6周（2月3日 - 2月9日）

**记录人**：贾一飞  
**实习方向**：AxVisor 自动测试系统开发与完善

---

## 本周工作内容

### 1. x86_64 NimbOS 验证（2月3日）

#### 环境准备
- 创建 `scripts/setup_qemu_nimbos.sh` 脚本
  - 自动下载 NimbOS 镜像
  - 配置 rootfs 内核注入（usertests）
  - 修补 VM 配置文件

#### QEMU 配置（KVM 模式）
- 创建 `qemu-x86_64-kvm.toml` 配置文件
- 使用 KVM 加速（需要 VT-x 支持）
- 配置 `-cpu host` 以传递 VMX 特性

#### 测试结果
- 在支持 VT-x 的环境中验证通过
- 成功看到 `usertests passed!`
- **测试通过** ✅

#### WSL2 环境限制说明
- WSL2 不支持嵌套虚拟化，无法使用 KVM
- 使用 TCG 软件虚拟化时，AxVisor 无法检测到 VMX 支持
- 需要在原生 Linux 或支持 VT-x 的环境中测试

### 2. 文档输出

- `docs/x86_64-NimbOS验证说明.md` - NimbOS 验证完整流程文档
- 更新 `docs/多Guest测试记录.md` - 添加 NimbOS 测试记录

### 3. 开发日志仓库整理

- 更新 `实习计划.md` 任务状态
- 创建 `logs/` 目录结构
- 开始按周记录开发日志

---

## 测试组合现状总结

| 架构 | Guest 系统 | 状态 | 成功标志 |
|------|-----------|------|----------|
| aarch64 | ArceOS | ✅ 已验证 | `Hello, world!` |
| aarch64 | Linux | ✅ 已验证 | `test pass!` |
| x86_64 | NimbOS | ✅ 已验证（需 VT-x） | `usertests passed!` |

---

## 遇到的问题与解决方案

### 问题1：WSL2 不支持嵌套虚拟化
- **问题**：在 WSL2 中使用 TCG 模式时，AxVisor 检测不到 VMX 支持
- **分析**：AxVisor x86_64 路径需要底层 CPU 支持 VT-x/VMX
- **解决**：在支持 VT-x 的原生 Linux 环境中使用 KVM 模式测试

### 问题2：NimbOS rootfs 需要注入 usertests 内核
- **问题**：默认 rootfs 不包含测试程序
- **解决**：在 setup 脚本中自动注入 `qemu-x86_64_usertests` 到 rootfs

---

## 下周计划（2月10日 - 2月16日）

1. **第一阶段学习总结**
   - 整理完整的学习笔记
   - 准备阶段总结报告
   - 梳理已完成的工作和产出

2. **合作沟通**
   - 联系蒋奇润，讨论后续合作分工

3. **测试配置扩展**
   - 扩展 qemu-aarch64.toml 的 success_regex、fail_regex
   - 研究更多测试场景

4. **进入第二阶段**
   - 根据计划开始集成测试环境功能实施
   - 选择要实施的未实现功能

---

## 学习收获

1. 理解了 x86_64 平台 AxVisor 对 VT-x/VMX 的依赖
2. 掌握了 KVM vs TCG 的差异和适用场景
3. 了解了 rootfs 内核注入的方法

---

**日志创建时间**：2026年2月3日  
**状态**：进行中
